[
  {
    "objectID": "Lab_10.html",
    "href": "Lab_10.html",
    "title": "Lab 10",
    "section": "",
    "text": "Libraries\n\n# spatial data science\nlibrary(tidyverse)\n\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.5\n✔ forcats   1.0.0     ✔ stringr   1.5.1\n✔ ggplot2   3.5.1     ✔ tibble    3.2.1\n✔ lubridate 1.9.4     ✔ tidyr     1.3.1\n✔ purrr     1.0.4     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors\n\nlibrary(sf)\n\nLinking to GEOS 3.13.0, GDAL 3.8.5, PROJ 9.5.1; sf_use_s2() is TRUE\n\nlibrary(units)\n\nudunits database from /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library/units/share/udunits/udunits2.xml\n\n# Data\nlibrary(AOI)\n\n# Visualization\nlibrary(gghighlight)\nlibrary(ggrepel)\nlibrary(knitr)\n\n\nlibrary(rnaturalearth)\nlibrary(rnaturalearthdata)\n\n\nAttaching package: 'rnaturalearthdata'\n\n\nThe following object is masked from 'package:rnaturalearth':\n\n    countries110\n\nlibrary(sf)\n\nworld &lt;- ne_countries(scale = \"medium\", returnclass = \"sf\")\n\n\neqdc &lt;- '+proj=eqdc +lat_0=40 +lon_0=-96 +lat_1=20 +lat_2=60 +x_0=0 +y_0=0 +datum=NAD83 +units=m +no_defs'\n\n\naoi_get(state = 'conus')\n\nSimple feature collection with 49 features and 14 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: -124.8485 ymin: 24.39631 xmax: -66.88544 ymax: 49.38448\nGeodetic CRS:  WGS 84\nFirst 10 features:\n   state_region state_division feature_code           state_name state_abbr\n1             3              6      1779775              Alabama         AL\n2             4              8      1779777              Arizona         AZ\n3             3              7      0068085             Arkansas         AR\n4             4              9      1779778           California         CA\n5             4              8      1779779             Colorado         CO\n6             1              1      1779780          Connecticut         CT\n7             3              5      1779781             Delaware         DE\n8             3              5      1702382 District of Columbia         DC\n9             3              5      0294478              Florida         FL\n10            3              5      1705317              Georgia         GA\n                   name fip_class tiger_class combined_area_code\n1               Alabama      &lt;NA&gt;       G4000                 NA\n2               Arizona      &lt;NA&gt;       G4000                 NA\n3              Arkansas      &lt;NA&gt;       G4000                 NA\n4            California      &lt;NA&gt;       G4000                 NA\n5              Colorado      &lt;NA&gt;       G4000                 NA\n6           Connecticut      &lt;NA&gt;       G4000                 NA\n7              Delaware      &lt;NA&gt;       G4000                 NA\n8  District of Columbia      &lt;NA&gt;       G4000                 NA\n9               Florida      &lt;NA&gt;       G4000                 NA\n10              Georgia      &lt;NA&gt;       G4000                 NA\n   metropolitan_area_code functional_status    land_area  water_area fip_code\n1                    &lt;NA&gt;                 A 131175477769  4591897964       01\n2                    &lt;NA&gt;                 A 294363973043   855871553       04\n3                    &lt;NA&gt;                 A 134660767709  3121950081       05\n4                    &lt;NA&gt;                 A 403671756816 20293573058       06\n5                    &lt;NA&gt;                 A 268418796417  1185716938       08\n6                    &lt;NA&gt;                 A  12541690473  1816424193       09\n7                    &lt;NA&gt;                 A   5046731559  1399179670       10\n8                    &lt;NA&gt;                 A    158316124    18709762       11\n9                    &lt;NA&gt;                 A 138961722096 45972570361       12\n10                   &lt;NA&gt;                 A 149486624386  4418360134       13\n                         geometry\n1  MULTIPOLYGON (((-85.4883 30...\n2  MULTIPOLYGON (((-110.7507 3...\n3  MULTIPOLYGON (((-90.95577 3...\n4  MULTIPOLYGON (((-116.1062 3...\n5  MULTIPOLYGON (((-105.155 36...\n6  MULTIPOLYGON (((-72.5279 41...\n7  MULTIPOLYGON (((-75.13846 3...\n8  MULTIPOLYGON (((-77.00244 3...\n9  MULTIPOLYGON (((-83.10874 2...\n10 MULTIPOLYGON (((-81.09538 3...\n\n\n\naoi_get(country = c(\"MX\", \"CA\", \"USA\"))\n\nSimple feature collection with 3 features and 168 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: -171.7911 ymin: 14.53883 xmax: -52.6481 ymax: 83.23324\nGeodetic CRS:  WGS 84\n        featurecla scalerank labelrank               sovereignt sov_a3 adm0_dif\n4  Admin-0 country         1         2                   Canada    CAN        0\n5  Admin-0 country         1         2 United States of America    US1        1\n28 Admin-0 country         1         2                   Mexico    MEX        0\n   level              type tlc                    admin adm0_a3 geou_dif\n4      2 Sovereign country   1                   Canada     CAN        0\n5      2           Country   1 United States of America     USA        0\n28     2 Sovereign country   1                   Mexico     MEX        0\n                    geounit gu_a3 su_dif       subunit su_a3 brk_diff\n4                    Canada   CAN      0        Canada   CAN        0\n5  United States of America   USA      0 United States   USA        0\n28                   Mexico   MEX      0        Mexico   MEX        0\n                       name     name_long brk_a3      brk_name brk_group abbrev\n4                    Canada        Canada    CAN        Canada      &lt;NA&gt;   Can.\n5  United States of America United States    USA United States      &lt;NA&gt; U.S.A.\n28                   Mexico        Mexico    MEX        Mexico      &lt;NA&gt;   Mex.\n   postal                formal_en formal_fr    name_ciawf note_adm0 note_brk\n4      CA                   Canada      &lt;NA&gt;        Canada      &lt;NA&gt;     &lt;NA&gt;\n5      US United States of America      &lt;NA&gt; United States      &lt;NA&gt;     &lt;NA&gt;\n28     MX    United Mexican States      &lt;NA&gt;        Mexico      &lt;NA&gt;     &lt;NA&gt;\n                  name_sort name_alt mapcolor7 mapcolor8 mapcolor9 mapcolor13\n4                    Canada     &lt;NA&gt;         6         6         2          2\n5  United States of America     &lt;NA&gt;         4         5         1          1\n28                   Mexico     &lt;NA&gt;         6         1         7          3\n     pop_est pop_rank pop_year   gdp_md gdp_year                  economy\n4   37589262       15     2019  1736425     2019  1. Developed region: G7\n5  328239523       17     2019 21433226     2019  1. Developed region: G7\n28 127575529       17     2019  1268870     2019 4. Emerging region: MIKT\n               income_grp fips_10 iso_a2 iso_a2_eh iso_a3 iso_a3_eh iso_n3\n4    1. High income: OECD      CA     CA        CA    CAN       CAN    124\n5    1. High income: OECD      US     US        US    USA       USA    840\n28 3. Upper middle income      MX     MX        MX    MEX       MEX    484\n   iso_n3_eh un_a3 wb_a2 wb_a3   woe_id woe_id_eh                   woe_note\n4        124   124    CA   CAN 23424775  23424775 Exact WOE match as country\n5        840   840    US   USA 23424977  23424977 Exact WOE match as country\n28       484   484    MX   MEX 23424900  23424900 Exact WOE match as country\n   adm0_iso adm0_diff adm0_tlc adm0_a3_us adm0_a3_fr adm0_a3_ru adm0_a3_es\n4       CAN      &lt;NA&gt;      CAN        CAN        CAN        CAN        CAN\n5       USA      &lt;NA&gt;      USA        USA        USA        USA        USA\n28      MEX      &lt;NA&gt;      MEX        MEX        MEX        MEX        MEX\n   adm0_a3_cn adm0_a3_tw adm0_a3_in adm0_a3_np adm0_a3_pk adm0_a3_de adm0_a3_gb\n4         CAN        CAN        CAN        CAN        CAN        CAN        CAN\n5         USA        USA        USA        USA        USA        USA        USA\n28        MEX        MEX        MEX        MEX        MEX        MEX        MEX\n   adm0_a3_br adm0_a3_il adm0_a3_ps adm0_a3_sa adm0_a3_eg adm0_a3_ma adm0_a3_pt\n4         CAN        CAN        CAN        CAN        CAN        CAN        CAN\n5         USA        USA        USA        USA        USA        USA        USA\n28        MEX        MEX        MEX        MEX        MEX        MEX        MEX\n   adm0_a3_ar adm0_a3_jp adm0_a3_ko adm0_a3_vn adm0_a3_tr adm0_a3_id adm0_a3_pl\n4         CAN        CAN        CAN        CAN        CAN        CAN        CAN\n5         USA        USA        USA        USA        USA        USA        USA\n28        MEX        MEX        MEX        MEX        MEX        MEX        MEX\n   adm0_a3_gr adm0_a3_it adm0_a3_nl adm0_a3_se adm0_a3_bd adm0_a3_ua adm0_a3_un\n4         CAN        CAN        CAN        CAN        CAN        CAN        -99\n5         USA        USA        USA        USA        USA        USA        -99\n28        MEX        MEX        MEX        MEX        MEX        MEX        -99\n   adm0_a3_wb     continent region_un        subregion\n4         -99 North America  Americas Northern America\n5         -99 North America  Americas Northern America\n28        -99 North America  Americas  Central America\n                   region_wb name_len long_len abbrev_len tiny homepart\n4              North America        6        6          4  -99        1\n5              North America       24       13          6  -99        1\n28 Latin America & Caribbean        6        6          4  -99        1\n   min_zoom min_label max_label   label_x  label_y      ne_id wikidataid\n4         0       1.7       5.7 -101.9107 60.32429 1159320467        Q16\n5         0       1.7       5.7  -97.4826 39.53848 1159321369        Q30\n28        0       2.0       6.7 -102.2894 23.91999 1159321055        Q96\n            name_ar         name_bn            name_de                  name_en\n4              كندا          কানাডা             Kanada                   Canada\n5  الولايات المتحدة মার্কিন যুক্তরাষ্ট্র Vereinigte Staaten United States of America\n28          المكسيك         মেক্সিকো             Mexiko                   Mexico\n          name_es             name_fa    name_fr                     name_el\n4          Canadá              کانادا     Canada                     Καναδάς\n5  Estados Unidos ایالات متحده آمریکا États-Unis Ηνωμένες Πολιτείες Αμερικής\n28         México               مکزیک    Mexique                      Μεξικό\n       name_he          name_hi                   name_hu         name_id\n4         קנדה            कनाडा                    Kanada          Kanada\n5  ארצות הברית संयुक्त राज्य अमेरिका Amerikai Egyesült Államok Amerika Serikat\n28      מקסיקו           मेक्सिको                    Mexikó         Meksiko\n                 name_it        name_ja name_ko                      name_nl\n4                 Canada         カナダ  캐나다                       Canada\n5  Stati Uniti d'America アメリカ合衆国    미국 Verenigde Staten van Amerika\n28               Messico       メキシコ  멕시코                       Mexico\n             name_pl        name_pt name_ru name_sv                     name_tr\n4             Kanada         Canadá  Канада  Kanada                      Kanada\n5  Stany Zjednoczone Estados Unidos     США     USA Amerika Birleşik Devletleri\n28            Meksyk         México Мексика  Mexiko                     Meksika\n                   name_uk                name_ur name_vi name_zh name_zht\n4                   Канада                 کینیڈا  Canada  加拿大   加拿大\n5  Сполучені Штати Америки ریاستہائے متحدہ امریکا  Hoa Kỳ    美国     美國\n28                 Мексика                میکسیکو  México  墨西哥   墨西哥\n        fclass_iso tlc_diff      fclass_tlc fclass_us fclass_fr fclass_ru\n4  Admin-0 country     &lt;NA&gt; Admin-0 country      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;\n5  Admin-0 country     &lt;NA&gt; Admin-0 country      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;\n28 Admin-0 country     &lt;NA&gt; Admin-0 country      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;\n   fclass_es fclass_cn fclass_tw fclass_in fclass_np fclass_pk fclass_de\n4       &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;\n5       &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;\n28      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;\n   fclass_gb fclass_br fclass_il fclass_ps fclass_sa fclass_eg fclass_ma\n4       &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;\n5       &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;\n28      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;\n   fclass_pt fclass_ar fclass_jp fclass_ko fclass_vn fclass_tr fclass_id\n4       &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;\n5       &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;\n28      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;\n   fclass_pl fclass_gr fclass_it fclass_nl fclass_se fclass_bd fclass_ua\n4       &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;\n5       &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;\n28      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;\n                         geometry\n4  MULTIPOLYGON (((-122.84 49,...\n5  MULTIPOLYGON (((-122.84 49,...\n28 MULTIPOLYGON (((-117.1278 3...\n\n\n\nlibrary(readr)\ncities &lt;- read_csv(\"uscities.csv\", show_col_types = FALSE) %&gt;% \n  st_as_sf(coords = c(\"lng\", \"lat\"), crs = 4326) %&gt;% \n  st_transform(eqdc)\n\n\nlibrary(USAboundaries)\nlibrary(sf)\n\nstates &lt;- us_states()  # gets U.S. state boundaries as an sf object\n\n\n\n2.1\n\nlibrary(sf)\nlibrary(dplyr)\nlibrary(flextable)\n\n\nAttaching package: 'flextable'\n\n\nThe following object is masked from 'package:purrr':\n\n    compose\n\nusa_union &lt;- st_union(states)\n\nusa_border &lt;- st_cast(usa_union, \"MULTILINESTRING\")\n\ncities &lt;- st_transform(cities, st_crs(usa_border))\n\ncities$dist_to_border_km &lt;- apply(\n  st_distance(cities, usa_border), 1, min\n) / 1000 \n\n\nfarthest_cities &lt;- cities %&gt;%\n  arrange(desc(dist_to_border_km)) %&gt;%\n  slice(1:5) %&gt;%\n  st_drop_geometry() %&gt;%\n  select(city = city, state_name, dist_to_border_km)\n\nlibrary(flextable)\n\nfarthest_table &lt;- flextable(farthest_cities) %&gt;%\n  colformat_double(j = \"dist_to_border_km\", digits = 2) %&gt;%\n  set_header_labels(\n    city = \"City\",\n    state = \"State\",\n    dist_to_border_km = \"Distance to Border (km)\"\n  ) %&gt;%\n  autofit()\n\nfarthest_table\n\nCitystate_nameDistance to Border (km)Hill CityKansas1,033.82PalcoKansas1,030.40CatharineKansas1,029.69JenningsKansas1,028.71DresdenKansas1,028.70\n\n\n\n\n2.2\n\nlibrary(sf)\nlibrary(dplyr)\nlibrary(flextable)\n\n\nstate_borders &lt;- st_cast(states, \"MULTILINESTRING\")\n\n\nall_borders &lt;- st_union(state_borders)\n\n\ncities &lt;- st_transform(cities, st_crs(all_borders))\n\n\ncities$dist_to_state_border_km &lt;- apply(\n  st_distance(cities, all_borders), 1, min\n) / 1000 \n\n\nfarthest_cities &lt;- cities %&gt;%\n  arrange(desc(dist_to_state_border_km)) %&gt;%\n  slice(1:5) %&gt;%\n  st_drop_geometry() %&gt;%\n  select(city = city, state_name, dist_to_state_border_km)\n\n\nfarthest_table &lt;- flextable(farthest_cities) %&gt;%\n  colformat_double(j = \"dist_to_state_border_km\", digits = 2) %&gt;%\n  set_header_labels(\n    city = \"City\",\n    state = \"State\",\n    dist_to_state_border_km = \"Distance to State Border (km)\"\n  ) %&gt;%\n  autofit()\n\nfarthest_table\n\nCitystate_nameDistance to State Border (km)Manley Hot SpringsAlaska416.90RampartAlaska414.54TananaAlaska413.17MintoAlaska399.20BettlesAlaska385.76\n\n\n\nlibrary(rnaturalearth)\nlibrary(sf)\n\n\ncountries &lt;- ne_countries(scale = \"medium\", returnclass = \"sf\")\n\n\nmexico &lt;- countries %&gt;% filter(admin == \"Mexico\")\n\n\n\n2.3\n\nlibrary(sf)\nlibrary(dplyr)\nlibrary(flextable)\n\n\nmexico &lt;- countries %&gt;% filter(admin == \"Mexico\")\n\n\nmexico_border &lt;- st_cast(st_union(mexico), \"MULTILINESTRING\")\n\n\ncities &lt;- st_transform(cities, st_crs(mexico_border))\n\n\ncities$dist_to_mexico_km &lt;- apply(\n  st_distance(cities, mexico_border), 1, min\n) / 1000  \n\nfarthest_cities &lt;- cities %&gt;%\n  arrange(desc(dist_to_mexico_km)) %&gt;%\n  slice(1:5) %&gt;%\n  st_drop_geometry() %&gt;%\n  select(city = city, state_name, dist_to_mexico_km)\n\nfarthest_table &lt;- flextable(farthest_cities) %&gt;%\n  colformat_double(j = \"dist_to_mexico_km\", digits = 2) %&gt;%\n  set_header_labels(\n    city = \"City\",\n    state = \"State\",\n    dist_to_mexico_km = \"Distance to Mexico (km)\"\n  ) %&gt;%\n  autofit()\n\nfarthest_table\n\nCitystate_nameDistance to Mexico (km)Attu StationAlaska5,868.26Eareckson StationAlaska5,804.38AdakAlaska5,180.49GambellAlaska5,080.56Point HopeAlaska5,052.32\n\n\n\n\n2.4\n\nlibrary(sf)\nlibrary(dplyr)\nlibrary(flextable)\n\n\ncanada &lt;- countries %&gt;% filter(admin == \"Canada\")\n\n\ncanada_border &lt;- st_cast(st_union(canada), \"MULTILINESTRING\")\n\n\ncities &lt;- st_transform(cities, st_crs(canada_border))\n\n\ncities$dist_to_canada_km &lt;- apply(\n  st_distance(cities, canada_border), 1, min\n) / 1000 \n\n\nfarthest_cities &lt;- cities %&gt;%\n  arrange(desc(dist_to_canada_km)) %&gt;%\n  slice(1:5) %&gt;%\n  st_drop_geometry() %&gt;%\n  select(city = city, state_name, dist_to_canada_km)\n\nfarthest_table &lt;- flextable(farthest_cities) %&gt;%\n  colformat_double(j = \"dist_to_canada_km\", digits = 2) %&gt;%\n  set_header_labels(\n    city = \"City\",\n    state = \"State\",\n    dist_to_canada_km = \"Distance to Canada (km)\"\n  ) %&gt;%\n  autofit()\n\nfarthest_table\n\nCitystate_nameDistance to Canada (km)Hawaiian Ocean ViewHawaii4,240.32Discovery HarbourHawaii4,239.27WaiohinuHawaii4,235.77NaalehuHawaii4,234.21PahalaHawaii4,216.72\n\n\n\n\n3.1\n\nlibrary(ggplot2)\nlibrary(ggrepel)\nlibrary(sf)\nlibrary(dplyr)\n\nnorth_america &lt;- world %&gt;%\n  filter(admin %in% c(\"United States of America\", \"Canada\", \"Mexico\"))\n\nconus_states &lt;- states %&gt;% filter(!state_abbr %in% c(\"AK\", \"HI\", \"PR\"))\nconus_outline &lt;- st_union(conus_states) \n\n\ntop10_cities &lt;- cities %&gt;% \n  arrange(desc(population)) %&gt;%\n  slice(1:10)\n\n\nggplot() +\n\n  geom_sf(data = north_america, fill = \"gray95\", color = \"gray80\", lty = \"solid\", size = 0.3) +\n  \n  \n  geom_sf(data = conus_outline, fill = NA, color = \"black\", lty = \"longdash\", size = 1) +\n  \n  \n  geom_sf(data = conus_states, fill = NA, color = \"blue\", lty = \"dotted\", size = 0.5) +\n  \n  \n  geom_sf(data = top10_cities, color = \"red\", size = 2) +\n  \n  ggrepel::geom_label_repel(\n    data = top10_cities,\n    aes(label = city, geometry = geometry),\n    stat = \"sf_coordinates\",\n    size = 3,\n    min.segment.length = 0,\n    box.padding = 0.5,  \n    max.overlaps = Inf\n  ) +\n  \n  theme_minimal() +\n  labs(title = \"Top 10 Largest U.S. Cities with State, CONUS, and North American Context\") +\n  coord_sf(xlim = c(-130, -60), ylim = c(20, 55)) \n\nWarning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not\ngive correct results for longitude/latitude data\n\n\n\n\n\n\n\n\n\n\n\n3.2\n\nlibrary(ggplot2)\nlibrary(ggrepel)\nlibrary(dplyr)\nlibrary(sf)\n\ncities$dist_to_border_km &lt;- apply(st_distance(cities, usa_border), 1, min) / 1000  \n\nfarthest_cities &lt;- cities %&gt;%\n  arrange(desc(dist_to_border_km)) %&gt;%\n  slice(1:5)\n\n\nggplot() +\n  \n  geom_sf(data = cities, aes(color = dist_to_border_km), size = 1, shape = 16) +\n  \n\n  geom_sf(data = farthest_cities, aes(color = dist_to_border_km), size = 3, shape = 16) +\n  ggrepel::geom_label_repel(\n    data = farthest_cities,\n    aes(label = city, geometry = geometry),\n    stat = \"sf_coordinates\",\n    size = 3,\n    min.segment.length = 0.5,\n    box.padding = 0.5\n  ) +\n  \n  \n  scale_color_viridis_c(option = \"plasma\", name = \"Distance to Border (km)\") +  \n  theme_minimal() +\n  labs(title = \"USA Cities Colored by Distance to National Border\") +\n  coord_sf(xlim = c(-130, -60), ylim = c(20, 55)) \n\nWarning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not\ngive correct results for longitude/latitude data\n\n\n\n\n\n\n\n\n\n\n\n3.3\n\nlibrary(ggplot2)\nlibrary(ggrepel)\nlibrary(dplyr)\nlibrary(sf)\n\n\n\ncities$dist_to_state_border_km &lt;- apply(st_distance(cities, states), 1, min) / 1000  \n\n\nfarthest_state_border_cities &lt;- cities %&gt;%\n  arrange(desc(dist_to_state_border_km)) %&gt;%\n  slice(1:5)\n\n\nggplot() +\n \n  geom_sf(data = cities, aes(color = dist_to_state_border_km), size = 1, shape = 16) +\n  \n \n  geom_sf(data = farthest_state_border_cities, aes(color = dist_to_state_border_km), size = 3, shape = 16) +\n  \n \n  ggrepel::geom_label_repel(\n    data = farthest_state_border_cities,\n    aes(label = city, geometry = geometry),\n    stat = \"sf_coordinates\",\n    size = 3,\n    min.segment.length = 0.5,\n    box.padding = 0.5\n  ) +\n  \n \n  scale_color_viridis_c(option = \"plasma\", name = \"Distance to Nearest State Border (km)\") +  \n  theme_minimal() +\n  labs(title = \"USA Cities Colored by Distance to Nearest State Border\") +\n  coord_sf(xlim = c(-130, -60), ylim = c(20, 55))  \n\nWarning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not\ngive correct results for longitude/latitude data\n\n\n\n\n\n\n\n\n\n\n\n3.4\n\nlibrary(ggplot2)\nlibrary(dplyr)\nlibrary(sf)\nlibrary(gghighlight)\nlibrary(ggrepel)\n\ncities$dist_to_canada_km &lt;- apply(st_distance(cities, canada_border), 1, min) / 1000  \ncities$dist_to_mexico_km &lt;- apply(st_distance(cities, mexico_border), 1, min) / 1000  \n\n\ncities$border_diff_km &lt;- abs(cities$dist_to_canada_km - cities$dist_to_mexico_km)\n\n\nequidistant_cities &lt;- cities %&gt;%\n  filter(border_diff_km &lt;= 100)\n\n\ntop5_populous &lt;- equidistant_cities %&gt;%\n  arrange(desc(population)) %&gt;%\n  slice(1:5)\n\n\ncities$highlight &lt;- ifelse(cities$city %in% equidistant_cities$city, \"highlight\", \"other\")\n\n\nggplot() +\n\n  geom_sf(data = cities, aes(color = dist_to_canada_km), size = 1, alpha = 0.7) +\n  \n\n  geom_sf(data = equidistant_cities, aes(fill = \"highlight\"), color = \"red\", size = 3, alpha = 0.7) +\n  \n  geom_sf(data = top5_populous, aes(color = dist_to_canada_km), size = 4, shape = 16) +\n  \n \n  ggrepel::geom_label_repel(\n    data = top5_populous,\n    aes(label = city, geometry = geometry),\n    stat = \"sf_coordinates\",\n    size = 3,\n    min.segment.length = 0.5,\n    box.padding = 0.5\n  ) +\n  \n\n  scale_color_viridis_c(option = \"plasma\", name = \"Distance to Canada (km)\") +\n  \n\n  scale_fill_manual(values = c(\"highlight\" = \"red\"), \n                    name = \"Equidistant Cities\") +\n  \n  theme_minimal() +\n  labs(title = \"Cities Equidistant from Canada and Mexico (Within 100 km)\") +\n  coord_sf(xlim = c(-130, -60), ylim = c(20, 55)) \n\nWarning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not\ngive correct results for longitude/latitude data\n\n\n\n\n\n\n\n\n\n\n\n4.1\n\nlibrary(dplyr)\nlibrary(tibble)\n\nborder_zone_cities &lt;- cities %&gt;%\n  filter(dist_to_border_km &lt;= 160)\n\nnum_cities &lt;- nrow(border_zone_cities)\n\nborder_zone_population &lt;- sum(border_zone_cities$population, na.rm = TRUE)\n\ntotal_population &lt;- sum(cities$population, na.rm = TRUE)\n\npercent_population &lt;- (border_zone_population / total_population) * 100\n\naclu_estimate &lt;- 66 \n\nborder_summary &lt;- tibble(\n  `Cities in 100-Mile Zone` = num_cities,\n  `Population in Zone` = border_zone_population,\n  `Total Population` = total_population,\n  `Percent of Population in Zone` = round(percent_population, 2),\n  `Matches ACLU Estimate?` = ifelse(round(percent_population, 1) &gt;= (aclu_estimate - 5) &\n                                    round(percent_population, 1) &lt;= (aclu_estimate + 5),\n                                    \"Roughly Yes\", \"No\")\n)\n\nborder_summary\n\n# A tibble: 1 × 5\n  `Cities in 100-Mile Zone` `Population in Zone` `Total Population`\n                      &lt;int&gt;                &lt;dbl&gt;              &lt;dbl&gt;\n1                     13678            261357769          402301854\n# ℹ 2 more variables: `Percent of Population in Zone` &lt;dbl&gt;,\n#   `Matches ACLU Estimate?` &lt;chr&gt;\n\n\n\n\n4.2\n\nlibrary(ggplot2)\nlibrary(dplyr)\nlibrary(gghighlight)\nlibrary(sf)\n\nborder_zone_cities &lt;- cities %&gt;%\n  filter(dist_to_border_km &lt;= 160)\n\ntop10_cities &lt;- border_zone_cities %&gt;%\n  arrange(desc(population)) %&gt;%\n  slice(1:10)\n\nggplot() +\n  geom_sf(data = cities, aes(geometry = geometry), color = \"grey80\", size = 0.3) +\n  geom_sf(data = border_zone_cities, aes(geometry = geometry, color = population), size = 1) +\n  scale_color_gradient(low = \"orange\", high = \"darkred\", name = \"Population\") +\n  geom_sf_label(data = top10_cities, aes(geometry = geometry, label = city), size = 3, label.size = 0.2) +\n  gghighlight(dist_to_border_km &lt;= 160, use_direct_label = FALSE) +\n  coord_sf(xlim = c(-130, -65), ylim = c(25, 50)) +  # Adjust bounds as needed\n  theme_minimal() +\n  labs(\n    title = \"U.S. Cities Within 100 Miles of the Border\",\n    subtitle = \"Cities highlighted by proximity to the border\\nTop 10 populous cities labeled\",\n    x = NULL, y = NULL\n  )\n\nWarning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not\ngive correct results for longitude/latitude data\nWarning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not\ngive correct results for longitude/latitude data\nWarning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not\ngive correct results for longitude/latitude data\nWarning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not\ngive correct results for longitude/latitude data\nWarning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not\ngive correct results for longitude/latitude data\nWarning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not\ngive correct results for longitude/latitude data\nWarning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not\ngive correct results for longitude/latitude data\nWarning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not\ngive correct results for longitude/latitude data\nWarning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not\ngive correct results for longitude/latitude data\nWarning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not\ngive correct results for longitude/latitude data\nWarning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not\ngive correct results for longitude/latitude data\n\n\n\n\n\n\n\n\n\n\n\n4.3\n\nborder_zone_cities &lt;- cities %&gt;%\n  filter(dist_to_border_km &lt;= 160)\n\ntop_city_per_state &lt;- border_zone_cities %&gt;%\n  group_by(state_name) %&gt;%\n  slice_max(population, n = 1, with_ties = FALSE) %&gt;%\n  ungroup()\n\nggplot() +\n  geom_sf(data = cities, aes(geometry = geometry), color = \"grey80\", size = 0.3) +\n  geom_sf(data = border_zone_cities, aes(geometry = geometry, color = population), size = 1) +\n  scale_color_gradient(low = \"orange\", high = \"darkred\", name = \"Population\") +\n  geom_sf_label(data = top_city_per_state, aes(geometry = geometry, label = city), \n                size = 3, label.size = 0.2) +\n  gghighlight(dist_to_border_km &lt;= 160, use_direct_label = FALSE) +\n  coord_sf(xlim = c(-130, -65), ylim = c(25, 50)) +\n  theme_minimal() +\n  labs(\n    title = \"Most Populous Cities Within 100 Miles of the U.S. Border\",\n    subtitle = \"One labeled city per state in the border zone\",\n    x = NULL, y = NULL\n  )\n\nWarning: Tried to calculate with group_by(), but the calculation failed.\nFalling back to ungrouped filter operation...\n\n\nWarning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not\ngive correct results for longitude/latitude data\nWarning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not\ngive correct results for longitude/latitude data\nWarning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not\ngive correct results for longitude/latitude data\nWarning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not\ngive correct results for longitude/latitude data\nWarning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not\ngive correct results for longitude/latitude data\nWarning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not\ngive correct results for longitude/latitude data\nWarning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not\ngive correct results for longitude/latitude data\nWarning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not\ngive correct results for longitude/latitude data\nWarning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not\ngive correct results for longitude/latitude data\nWarning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not\ngive correct results for longitude/latitude data\nWarning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not\ngive correct results for longitude/latitude data\nWarning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not\ngive correct results for longitude/latitude data\nWarning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not\ngive correct results for longitude/latitude data\nWarning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not\ngive correct results for longitude/latitude data\nWarning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not\ngive correct results for longitude/latitude data\nWarning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not\ngive correct results for longitude/latitude data\nWarning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not\ngive correct results for longitude/latitude data\nWarning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not\ngive correct results for longitude/latitude data\nWarning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not\ngive correct results for longitude/latitude data\nWarning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not\ngive correct results for longitude/latitude data\nWarning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not\ngive correct results for longitude/latitude data\nWarning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not\ngive correct results for longitude/latitude data\nWarning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not\ngive correct results for longitude/latitude data\nWarning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not\ngive correct results for longitude/latitude data\nWarning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not\ngive correct results for longitude/latitude data\nWarning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not\ngive correct results for longitude/latitude data\nWarning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not\ngive correct results for longitude/latitude data\nWarning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not\ngive correct results for longitude/latitude data\nWarning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not\ngive correct results for longitude/latitude data\nWarning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not\ngive correct results for longitude/latitude data\nWarning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not\ngive correct results for longitude/latitude data\nWarning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not\ngive correct results for longitude/latitude data\nWarning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not\ngive correct results for longitude/latitude data\nWarning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not\ngive correct results for longitude/latitude data\nWarning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not\ngive correct results for longitude/latitude data\nWarning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not\ngive correct results for longitude/latitude data\nWarning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not\ngive correct results for longitude/latitude data\nWarning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not\ngive correct results for longitude/latitude data\nWarning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not\ngive correct results for longitude/latitude data"
  }
]